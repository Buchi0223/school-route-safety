# 通学路安全確認デモアプリ モバイル版UI改良 仕様書

**文書バージョン**: 1.0
**作成日**: 2026年1月16日
**ステータス**: レビュー待ち

---

## 1. 概要

### 1.1 目的
モバイル版アプリのUIを改良し、より直感的で子供と保護者が一緒に楽しめる「通学路探検モード」を実装する。

### 1.2 対象ユーザー
- 小学生とその保護者
- スマートフォンでの利用を想定

### 1.3 主な変更点
- 画面上部に帯状メニューを配置
- 新機能「通学路探検モード」の追加
- キャラクターによるガイド機能
- 完了時の賞状風演出

---

## 2. 画面構成

### 2.1 基本レイアウト

```
┌─────────────────────────────────┐
│  ヘッダーメニュー（帯状）        │
├─────────────────────────────────┤
│                                 │
│                                 │
│         地図表示エリア           │
│         （フルスクリーン）        │
│                                 │
│                                 │
│                                 │
└─────────────────────────────────┘
```

### 2.2 ヘッダーメニュー

| メニュー項目 | アイコン | 説明 |
|-------------|---------|------|
| 経路検索 | 🔍 | 出発地〜目的地の経路設定 |
| 通学路探検 | 🎒 | 探検モードの開始 |
| アイコン説明 | ❓ | 危険タイプ説明・操作ガイド |

**デザイン仕様**:
- 高さ: 48px
- 背景色: #FFFFFF（白）
- 下部ボーダー: 1px solid #E5E5E5
- メニューアイテム: 均等配置、タップ領域は高さ全体

---

## 3. 経路検索機能

### 3.1 概要
既存の経路検索機能をオーバーレイ形式で表示する。

### 3.2 オーバーレイUI

```
┌─────────────────────────────────┐
│  ヘッダーメニュー               │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │ 経路検索              ✕    │ │
│ ├─────────────────────────────┤ │
│ │ スタート地点（S）          │ │
│ │ [地図をタップして設定]      │ │
│ ├─────────────────────────────┤ │
│ │ ゴール地点（G）            │ │
│ │ [地図をタップして設定]      │ │
│ ├─────────────────────────────┤ │
│ │ [クリア] [ルート計算]      │ │
│ └─────────────────────────────┘ │
│                                 │
│         地図（背景）            │
│                                 │
└─────────────────────────────────┘
```

### 3.3 動作フロー
1. メニューから「経路検索」をタップ
2. オーバーレイが画面上部から表示
3. 地図をタップしてスタート/ゴールを設定
4. 「ルート計算」で経路を表示
5. ✕ボタンまたは背景タップでオーバーレイを閉じる

---

## 4. 通学路探検モード（新機能）

### 4.1 概要
保護者と子供が一緒に通学路の危険について考える体験型学習モード。

### 4.2 キャラクター仕様

**キャラクター名**: 未定（仮称: セーフティにゃん）

**画像ファイル**: `Character.png`
- ヘルメットを被った白猫
- Hondaのバンダナ着用
- 表情: 笑顔

**表示仕様**:
- サイズ: 80px × 80px（モバイル）
- 位置: 画面左下
- 背景: なし（透過PNG使用）

### 4.3 ステップ1: 経路設定

**画面構成**:
```
┌─────────────────────────────────┐
│  ヘッダーメニュー               │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │ 🎒 通学路探検モード        │ │
│ │                             │ │
│ │ まずは通学路を教えてね！    │ │
│ │ 地図をタップして           │ │
│ │ 経路を設定しよう           │ │
│ │                             │ │
│ │ S: [未設定]                │ │
│ │ G: [未設定]                │ │
│ │                             │ │
│ │ [探検スタート！]           │ │
│ └─────────────────────────────┘ │
│                                 │
│         地図                    │
│                                 │
└─────────────────────────────────┘
```

**動作**:
1. 「通学路探検」メニューをタップ
2. 経路設定用オーバーレイ表示
3. 地図タップでスタート/ゴール設定
4. 「探検スタート！」で次のステップへ
5. オーバーレイが閉じて探検モード開始

### 4.4 ステップ2: 経路ツアー

**画面構成**:
```
┌─────────────────────────────────┐
│  [終了]        探検中 🎒       │
├─────────────────────────────────┤
│                                 │
│                                 │
│      Google Street View         │
│         （全画面表示）           │
│                                 │
│                                 │
│  ┌─────┐                       │
│  │ 地図 │ ← 小窓オーバーレイ   │
│  │ 📍  │   (100x100px)        │
│  └─────┘                       │
├─────────────────────────────────┤
│  [◀][▶]  ━━━●━━━━  [⚙速度]   │
│          進捗バー               │
└─────────────────────────────────┘
```

**地図オーバーレイ仕様**:
- サイズ: 100px × 100px
- 位置: 画面左下（キャラクター表示時は右下へ移動）
- 現在位置をマーカー表示
- 経路をハイライト表示
- タップで拡大表示（オプション）

**コントロールバー仕様**:
- 高さ: 60px
- 背景: 半透明黒 (rgba(0,0,0,0.7))
- 要素:
  - 戻る/進むボタン
  - 進捗スライダー
  - 速度設定ボタン

### 4.5 ステップ3: 危険地点での学習

**画面構成**（危険地点で停止時）:
```
┌─────────────────────────────────┐
│  [終了]        ⚠️ 危険地点     │
├─────────────────────────────────┤
│                                 │
│      Google Street View         │
│        （停止中）               │
│                                 │
│                                 │
│  ┌─────┐                       │
│  │ 地図 │                      │
│  └─────┘                       │
│                                 │
│  ┌──────────────────────┐      │
│  │ 💬 ここには、どんな    │      │
│  │    危ない場所が        │      │
│  │    ひそんでいそうかな？ │      │
│  │    3つ探してみよう！   │      │
│😺└──────────────────────┘      │
├─────────────────────────────────┤
│        [タップして次へ]         │
└─────────────────────────────────┘
```

**セリフシーケンス**:

| 順番 | セリフ | アクション |
|-----|-------|----------|
| 1 | 「ここには、どんな危ない場所がひそんでいそうかな？3つ探してみよう！」 | タップで次へ |
| 2 | 「見つけた危ない場所で身を守るにはどうしたらいいかな？」 | タップで次へ |
| 3 | 「続きの道を進もう！」 | タップでツアー再開 |

**吹き出し仕様**:
- 背景色: #FFFFFF
- ボーダー: 2px solid #FFD700
- 角丸: 16px
- 影: 0 4px 8px rgba(0,0,0,0.15)
- フォント: 16px、太字
- アニメーション: フェードイン（0.3秒）

**キャラクター表示**:
- 位置: 吹き出しの左下
- サイズ: 80px × 80px
- アニメーション: 軽いバウンス（停止時）

### 4.6 ステップ4: ツアー完了

**画面構成**:
```
┌─────────────────────────────────┐
│                                 │
│      🎊 おつかれさま！ 🎊       │
│                                 │
│  ┌─────────────────────────┐   │
│  │                         │   │
│  │      📜 しょうじょう     │   │
│  │                         │   │
│  │   あなたは通学路の      │   │
│  │   安全マスターです！     │   │
│  │                         │   │
│  │   確認した危険地点: 5箇所 │   │
│  │   歩いた距離: 1.2km      │   │
│  │                         │   │
│  │       2026年1月16日      │   │
│  │                         │   │
│  │         😺              │   │
│  │      セーフティにゃん    │   │
│  │                         │   │
│  └─────────────────────────┘   │
│                                 │
│      [もう一度探検する]         │
│      [ホームに戻る]             │
│                                 │
└─────────────────────────────────┘
```

**賞状仕様**:
- 背景色: #FFFEF0（クリーム色）
- ボーダー: 金色のグラデーション（#FFD700 → #FFA500）
- ボーダー幅: 8px
- 内側装飾: 点線ボーダー
- アニメーション: スケールイン + 紙吹雪エフェクト

**表示内容**:
- タイトル: 「しょうじょう」
- 本文: 「あなたは通学路の安全マスターです！」
- 統計情報:
  - 確認した危険地点数
  - 歩いた距離（経路の総距離）
- 日付
- キャラクター署名

---

## 5. アイコン説明メニュー

### 5.1 概要
危険タイプの説明と操作ガイドを表示するオーバーレイ。

### 5.2 画面構成

```
┌─────────────────────────────────┐
│  ヘッダーメニュー               │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │ ❓ ヘルプ             ✕    │ │
│ ├─────────────────────────────┤ │
│ │                             │ │
│ │ 【危険地点の種類】          │ │
│ │                             │ │
│ │ ⚠️ 見通しの悪い交差点       │ │
│ │    左右の確認が難しい場所   │ │
│ │                             │ │
│ │ 🔴 事故多発エリア           │ │
│ │    過去に事故が報告された場所│ │
│ │                             │ │
│ │ 🟠 急ブレーキ多発地点       │ │
│ │    車が急停止する場所       │ │
│ │                             │ │
│ │ 💬 ユーザー投稿情報         │ │
│ │    地域の方からの報告       │ │
│ │                             │ │
│ │ ─────────────────────────  │ │
│ │                             │ │
│ │ 【操作方法】                │ │
│ │                             │ │
│ │ 📍 地図をタップ             │ │
│ │    経由地点を追加           │ │
│ │                             │ │
│ │ 🎒 探検モード               │ │
│ │    通学路を体験学習         │ │
│ │                             │ │
│ └─────────────────────────────┘ │
│                                 │
│         地図（背景）            │
│                                 │
└─────────────────────────────────┘
```

### 5.3 コンテンツ

**危険地点の種類**:

| アイコン | 種類 | 説明 |
|---------|-----|------|
| ⚠️ | 見通しの悪い交差点 | 塀や建物で左右の確認が難しい交差点 |
| 🔴 | 事故多発エリア | 過去に事故が報告されている場所 |
| 🟠 | 急ブレーキ多発地点 | 車が急停止することが多い場所 |
| 💬 | ユーザー投稿情報 | 地域住民からの危険報告 |

**操作方法**:

| 操作 | 説明 |
|-----|------|
| 地図をタップ | 経由地点を追加 |
| マーカーをタップ | 危険地点の詳細を表示 |
| 探検モード | Street Viewで通学路を体験 |

---

## 6. 技術仕様

### 6.1 使用コンポーネント

| コンポーネント名 | 説明 | 新規/既存 |
|----------------|------|----------|
| MobileHeader | 帯状メニュー | 新規 |
| RouteSearchOverlay | 経路検索オーバーレイ | 新規（既存機能を流用） |
| ExplorationMode | 探検モード全体管理 | 新規 |
| CharacterBubble | キャラクター＋吹き出し | 新規 |
| MiniMap | 小窓地図オーバーレイ | 新規 |
| TourControlsCompact | コンパクトツアーコントロール | 新規 |
| CertificateModal | 賞状モーダル | 新規 |
| HelpOverlay | ヘルプオーバーレイ | 新規 |

### 6.2 状態管理

```typescript
// 探検モードの状態
type ExplorationState =
  | 'idle'           // 未開始
  | 'route_setting'  // 経路設定中
  | 'touring'        // ツアー中
  | 'hazard_stop'    // 危険地点で停止
  | 'completed';     // 完了

// 危険地点での会話進行
type HazardDialogStep = 1 | 2 | 3;

interface ExplorationContext {
  state: ExplorationState;
  route: Route | null;
  currentPosition: [number, number] | null;
  visitedHazards: string[];
  currentHazard: HazardPoint | null;
  dialogStep: HazardDialogStep;
}
```

### 6.3 アニメーション

| 要素 | アニメーション | duration |
|-----|---------------|----------|
| オーバーレイ表示 | slideDown | 0.3s |
| オーバーレイ非表示 | slideUp | 0.2s |
| 吹き出し表示 | fadeIn + scale | 0.3s |
| キャラクター | bounce | 0.5s |
| 賞状表示 | scaleIn | 0.5s |
| 紙吹雪 | confetti | 2s |

### 6.4 アセット

| ファイル名 | 用途 | サイズ |
|-----------|------|-------|
| Character.png | ガイドキャラクター | トリミング後80x80px |
| confetti.json | 紙吹雪アニメーション | Lottieファイル（オプション） |

---

## 7. 実装優先度

### Phase 1（必須）
1. MobileHeader コンポーネント
2. RouteSearchOverlay コンポーネント
3. HelpOverlay コンポーネント

### Phase 2（探検モード基本）
4. ExplorationMode コンポーネント
5. MiniMap コンポーネント
6. TourControlsCompact コンポーネント

### Phase 3（探検モード演出）
7. CharacterBubble コンポーネント
8. CertificateModal コンポーネント
9. アニメーション実装

---

## 8. 画面遷移図

```
[ホーム（地図表示）]
    │
    ├─[経路検索]─→ [経路検索オーバーレイ] → [経路表示]
    │
    ├─[探検モード]─→ [経路設定] → [ツアー開始]
    │                               │
    │                               ├─→ [危険地点停止]
    │                               │      │
    │                               │      └─→ [セリフ1]
    │                               │           │
    │                               │           └─→ [セリフ2]
    │                               │                │
    │                               │                └─→ [セリフ3]
    │                               │                     │
    │                               │                     └─→ [ツアー再開]
    │                               │
    │                               └─→ [ツアー完了] → [賞状表示]
    │
    └─[アイコン説明]─→ [ヘルプオーバーレイ]
```

---

## 9. 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2026/01/16 | 初版作成 |

---

## 10. 付録

### 10.1 セリフテキスト一覧

```
// 経路設定時
"まずは通学路を教えてね！地図をタップして経路を設定しよう"

// ツアー開始時
"さあ、通学路の探検に出発だ！"

// 危険地点停止時
"ここには、どんな危ない場所がひそんでいそうかな？3つ探してみよう！"
"見つけた危ない場所で身を守るにはどうしたらいいかな？"
"続きの道を進もう！"

// ツアー完了時
"おつかれさま！通学路の安全マスターだね！"
```

### 10.2 カラーパレット

| 用途 | カラーコード |
|-----|-------------|
| メインカラー | #E60012（Honda Red） |
| アクセント | #FFD700（Gold） |
| 背景 | #FFFFFF |
| テキスト | #333333 |
| サブテキスト | #666666 |
| 危険警告 | #FF6B6B |
| 成功 | #4CAF50 |
