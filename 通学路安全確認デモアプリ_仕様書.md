# 通学路安全確認デモアプリ 仕様書

**文書バージョン**: 1.0  
**作成日**: 2025年1月15日  
**ステータス**: ドラフト

---

## 1. プロジェクト概要

### 1.1 背景と目的

本プロジェクトは、Honda Safety Mapのコンセプトを参考に、小学生の通学路における安全教育を支援するデモアプリケーションを開発するものである。

保護者が子どもと一緒に通学路上の危険箇所を確認し、交通安全意識を高めることを目的とする。Street Viewを活用したバーチャルツアー機能により、実際に歩かなくても危険箇所を視覚的に確認・学習できる環境を提供する。

### 1.2 プロジェクト名称

**通学路安全確認デモアプリ（School Route Safety Checker Demo）**

### 1.3 ターゲットユーザー

| ユーザー | 説明 |
|---------|------|
| 小学生を持つ保護者 | 主要ユーザー。子どもに危険箇所を教える |
| 小学生の子ども | 保護者と一緒に使用 |
| 学校関係者・PTA | 通学路の安全点検に活用 |

---

## 2. 機能要件

### 2.1 経路設定機能

| 機能 | 説明 |
|------|------|
| 出発地点設定 | 地図上でクリックまたは住所検索により自宅位置を設定 |
| 目的地設定 | 地図上でクリックまたは住所検索により学校位置を設定 |
| 経由地点設定 | 曲がり角をクリックして経由地点を追加し、実際の通学路に沿ったルートを設定可能 |
| ルート編集 | 設定した経由地点のドラッグ移動、削除が可能 |

### 2.2 危険地点表示機能

設定した経路上および周辺の危険地点を地図上に表示する。

| 危険タイプ | アイコン | 説明 |
|-----------|---------|------|
| intersection | ⚠️ 黄色三角 | 見通しの悪い交差点 |
| accident | 🔴 赤丸 | 事故多発エリア |
| braking | 🟠 橙色 | 急ブレーキ多発地点 |
| user_report | 💬 吹き出し | ユーザー投稿情報 |

### 2.3 Street Viewバーチャルツアー機能

| 機能 | 説明 |
|------|------|
| 経路追従表示 | 設定した経路に沿ってStreet Viewを順次表示 |
| 危険地点ジャンプ | 危険地点をクリックすると該当箇所のStreet Viewに移動 |
| 視点操作 | 360度パノラマ視点の回転、ズームイン・アウト |
| 進行コントロール | 前進・後退ボタン、一時停止、スキップ機能 |

### 2.4 安全学習ガイド機能

保護者が子どもと一緒に危険箇所を確認する際のインストラクションを表示する。

| 機能 | 説明 |
|------|------|
| チェックポイント表示 | 各危険地点で確認すべき項目をリスト表示 |
| 声かけ例 | 「ここでは何を確認すればいいかな？」等の会話例を提示 |
| 危険タイプ別解説 | 見通しの悪い交差点、飛び出し注意等の危険パターンを解説 |
| 安全行動のヒント | 「止まる・見る・待つ」等の具体的な行動指針を表示 |

---

## 3. 画面構成

### 3.1 メイン画面レイアウト

```
┌─────────────────────────────────────────────────────────┐
│  コントロールバー（経路設定・ツアー開始/停止・フィルタ）    │
├─────────────────────────────┬───────────────────────────┤
│                             │                           │
│                             │    Street View エリア     │
│     地図表示エリア           │        (右上 40%)         │
│       (左側 60%)            │                           │
│                             ├───────────────────────────┤
│     OSM地図                  │                           │
│     経路表示                 │    ガイドパネル           │
│     危険地点マーカー          │      (右下 40%)           │
│                             │    チェックポイント        │
│                             │    声かけ例               │
│                             │                           │
└─────────────────────────────┴───────────────────────────┘
```

### 3.2 モバイル対応

レスポンシブデザインにより、スマートフォン・タブレットでも利用可能。

- 地図とStreet Viewを切り替え表示（タブ式）
- ガイドパネルはアコーディオン形式で表示
- タッチ操作に最適化したUI

---

## 4. 技術要件

### 4.1 フロントエンド

| 技術 | バージョン | 選定理由 |
|------|-----------|---------|
| **Next.js** | 14.x (App Router) | ファイルベースルーティング、Vercelへの簡単デプロイ、最適化機能 |
| TypeScript | 5.x | 型安全性によりバグを未然に防止 |
| Tailwind CSS | 3.x | ユーティリティファーストでレスポンシブ対応が容易 |
| Leaflet | 1.9.x | OSM連携に最適、軽量でモバイル対応が良好 |
| react-leaflet | 4.x | LeafletのReactラッパー |

### 4.2 外部API・サービス

| サービス | 用途 |
|---------|------|
| OpenStreetMap (OSM) | 地図タイル、道路ネットワークデータ |
| OSRM | 歩行者向けルーティング（デモサーバー利用） |
| Google Street View API | パノラマ画像の表示（APIキー要） |

### 4.3 プロジェクト構成

```
school-route-safety/
├── app/
│   ├── layout.tsx
│   ├── page.tsx
│   ├── globals.css
│   └── components/
│       ├── Map/
│       │   ├── MapContainer.tsx
│       │   ├── RouteLayer.tsx
│       │   └── HazardMarkers.tsx
│       ├── StreetView/
│       │   └── StreetViewPanel.tsx
│       ├── Guide/
│       │   └── SafetyGuidePanel.tsx
│       └── Controls/
│           ├── RouteControls.tsx
│           └── TourControls.tsx
├── lib/
│   ├── types.ts
│   ├── hazardData.ts
│   └── routing.ts
├── public/
│   └── icons/
└── package.json
```

### 4.4 デプロイ・ホスティング

| 項目 | 内容 |
|------|------|
| ホスティング | Vercel（Next.jsとの親和性が高い） |
| ドメイン | Vercel提供のサブドメイン（xxx.vercel.app） |
| QRコード | デプロイ後のURLからQRコードを生成 |

---

## 5. データ仕様

### 5.1 危険地点データ（デモ用）

```typescript
// lib/types.ts
interface HazardPoint {
  id: string;
  type: 'intersection' | 'accident' | 'braking' | 'user_report';
  lat: number;
  lng: number;
  title: string;
  description: string;
  checkPoints: string[];
  voiceGuide: string;
  safetyTips: string[];
}

interface Route {
  id: string;
  name: string;
  waypoints: [number, number][];
  hazardPoints: string[]; // HazardPoint IDs on this route
}
```

### 5.2 サンプルデータ例

```json
{
  "hazardPoints": [
    {
      "id": "hp001",
      "type": "intersection",
      "lat": 36.5516,
      "lng": 139.8967,
      "title": "見通しの悪い交差点",
      "description": "塀が高く左右の確認が困難",
      "checkPoints": [
        "左右の安全確認",
        "一旦停止"
      ],
      "voiceGuide": "ここで止まって、左右を見てみよう。車が来ていないかな？",
      "safetyTips": [
        "止まる",
        "見る",
        "待つ"
      ]
    }
  ]
}
```

---

## 6. 開発フェーズ

### Phase 1：基本機能（MVP）
**想定工数**: 2〜3日

- [x] Next.jsプロジェクトセットアップ
- [ ] OSM地図表示（Leaflet）
- [ ] クリックによる経由地点設定
- [ ] OSRMによる経路描画
- [ ] サンプル危険地点のマーカー表示
- [ ] 危険地点クリックでStreet View表示

### Phase 2：ツアー機能
**想定工数**: 1〜2日

- [ ] 経路に沿ったStreet Viewバーチャルツアー
- [ ] 進行コントロール（前進・後退・停止）
- [ ] 危険地点での自動停止・ハイライト
- [ ] 現在位置の地図連動

### Phase 3：ガイド機能
**想定工数**: 1日

- [ ] 安全学習ガイドパネル実装
- [ ] チェックポイント・声かけ例の表示
- [ ] 危険タイプ別アイコン・解説
- [ ] レスポンシブデザイン調整

### Phase 4：仕上げ
**想定工数**: 0.5日

- [ ] UIブラッシュアップ
- [ ] QRコード生成・配置
- [ ] Vercelデプロイ
- [ ] 動作確認・微調整

**合計想定工数**: 約5日

---

## 7. 制約事項・注意点

| 項目 | 内容 |
|------|------|
| Google Street View API | APIキーが必要。利用規約の確認が必要 |
| Street Viewカバレッジ | 全ての道路でStreet Viewが利用できるわけではない |
| 危険地点データ | デモアプリのためサンプルデータを使用 |
| オフライン利用 | 本デモアプリはオンライン接続が必須 |
| OSRM制限 | 公開デモサーバーは利用制限あり |

---

## 8. 今後の拡張可能性

本デモアプリの発展形として、以下の機能拡張が考えられる。

- 実際のSafety Map危険地点データとの連携
- ユーザーによる危険地点投稿機能
- 経路の保存・共有機能（ローカルストレージ or DB）
- 安全確認クイズ・ゲーミフィケーション
- 学校・PTA向け管理機能
- 多言語対応

---

## 9. 参考資料

- [Honda Safety Map](https://safetymap.jp/)
- [Next.js Documentation](https://nextjs.org/docs)
- [Leaflet Documentation](https://leafletjs.com/)
- [Google Street View API](https://developers.google.com/maps/documentation/streetview)
- [OSRM API](http://project-osrm.org/docs/v5.24.0/api/)

---

*以上*
